# Root types
schema {
  query: Query
  mutation: Mutation
  subscription: Subscription
}

type Query {
  # System information
  health: SystemHealth!

  # KV Store queries
  kv(key: String!): KVPair
  kvList(prefix: String, limit: Int, offset: Int): KVListResponse!

  # Service Discovery queries
  service(name: String!): Service
  services(limit: Int, offset: Int): [Service!]!
  servicesCount: Int!

  # Service queries by tags and metadata
  servicesByTags(tags: [String!]!): [Service!]!
  servicesByMetadata(filters: [MetadataFilter!]!): [Service!]!
  servicesByQuery(tags: [String!], metadata: [MetadataFilter!]): [Service!]!
}

"""
Metadata filter for querying services by metadata
"""
input MetadataFilter {
  """Metadata key"""
  key: String!

  """Metadata value"""
  value: String!
}

"""
Mutation type for write operations
"""
type Mutation {
  # KV Store mutations
  kvSet(key: String!, value: String!): KVPair!
  kvDelete(key: String!): Boolean!
  kvCAS(key: String!, value: String!, index: Int!): KVPair

  # Service mutations
  registerService(input: RegisterServiceInput!): Service!
  deregisterService(name: String!): Boolean!
  updateHeartbeat(name: String!): Service!
}

"""
Subscription type for real-time updates
"""
type Subscription {
  # KV Store change events
  kvChanged(key: String, prefix: String): KVChangeEvent!

  # Service change events
  serviceChanged(name: String): ServiceChangeEvent!
}
